project.ext {
    PROTOC_DEPENDENCIES_TARGET_DIR = "target/protoc-dependencies/"
}

buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath 'com.google.protobuf:protobuf-gradle-plugin:0.5.0'
    }
}

apply plugin: 'com.google.protobuf'

dependencies {
    compile group: 'com.google.protobuf', name: 'protobuf-java', version: project.PROTOBUF_VERSION
}

//protocDep = "com.google.protobuf:protoc:${project.PROTOBUF_VERSION}"
//extractedProtosDir = "${project.buildDir.path}/extracted-protos"
//generatedFileDir = project.PROTOBUF_TARGET_DIR

def getProtocDependencyDir() {
    def name = ""
    file(project.PROTOC_DEPENDENCIES_TARGET_DIR).listFiles().each { File file ->
        file.listFiles().each { File googleFolderFile ->
            if (googleFolderFile.name.equals("google")) {
                googleFolderFile.listFiles().each { File protobufFolderFile ->
                    if (protobufFolderFile.name.equals("protobuf")) {
                        name = file.name;
                    }
                }
            }
        }
    }
    return name;
}

sourceSets {
    main {
        proto {
            srcDir project.PROTOC_DEPENDENCIES_TARGET_DIR + getProtocDependencyDir()
        }
    }
}

protobuf {
    protoc {
        artifact = project.PROTOBUF_DEPENDENCY
    }
//    plugins {
//        grpc {
//            artifact = project.GRPC_DEPENDENCY
//        }
//    }
    generatedFilesBaseDir = project.PROTOBUF_TARGET_DIR
}